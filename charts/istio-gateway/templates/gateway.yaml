apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: istio-autogenerated-k8s-ingress
  namespace: {{ $.Release.Namespace }}
  labels:
    app: {{ .Chart.Name | quote }}
    chart: {{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
spec:
  selector:
    istio: {{ .Values.gateway.selector }}
  servers:
{{- range $key, $spec := .Values.hosts }}
  - hosts:
    - '{{ $spec.host }}'
    {{- if (index $spec "tls") and (index $spec.tls "enabled") and ($spec.tls.enabled) }}
    port:
      name: https-{{ $key }}
      number: {{ $spec.port | default 443 }}
      protocol: HTTPS
    tls:
      credentialName: ingress-cert-{{ $spec.tls.issuer.name }}-{{ $key }}
      mode: SIMPLE
      privateKey: sds
      serverCertificate: sds
    {{- else }}
    port:
      name: http-{{ $key }}
      number: {{ $spec.port | default 80 }}
      protocol: HTTP2
    {{- if $spec.httpsRedirect }}
    tls:
      httpsRedirect: true
    {{- end }}
    {{- end }}
{{- end }}
